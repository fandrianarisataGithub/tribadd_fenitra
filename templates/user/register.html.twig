{% extends 'layout.html.twig' %}

{% block stylesheets %}

{% endblock %}

{% block body %}

    <h2 class="mb-1 ml-4">INSCRIPTION</h2>

    <div class="register col-xl-6 col-lg-8 col-md-7 col-sm-12">

        <div class="sub-register"></div>

        {{ form_start(form, {'attr': {'class': 'form-register', 'enctype': "multipart/form-data"}}) }}

            <div class="row">

                <div class="form-group col-6">

                    {{ form_widget(form.email) }}

                    <span id="emailHelp" class="form-text text-muted error-register">{{ form_errors(form.email) }}</span>

                </div>

                <div class="form-group col-6">

                    {{ form_widget(form.username) }}

                    <span id="usernameHelp" class="form-text text-muted error-register">{{ form_errors(form.username) }}</span>

                </div>

            </div>

            <div class="row">

                <div class="form-group col-6">

                    {{ form_widget(form.password.first) }}

                    <span id="pass1Help" class="form-text text-muted error-register">{{ form_errors(form.password.first) }}</span>

                </div>

                <div class="form-group col-6">

                    {{ form_widget(form.password.second) }}

                    <span id="pass2Help" class="form-text text-muted error-register">{{ form_errors(form.password.second) }}</span>

                </div>

            </div>

            <div class="row">

                <div class="form-group col-6">

                    {{ form_widget(form.nom) }}

                    <span id="nameHelp" class="form-text text-muted error-register">{{ form_errors(form.nom) }}</span>

                </div>

                <div class="form-group col-6">

                    {{ form_widget(form.prenom) }}

                    <span id="firstNameHelp" class="form-text text-muted error-register">{{ form_errors(form.prenom) }}</span>

                </div>

            </div>

            <div class="row">

                <div class="form-group col-12">

                    {{ form_widget(form.dateNaissance) }}

                    <span id="birthdayHelp" class="form-text text-muted error-register">{{ form_errors(form.dateNaissance) }}</span>

                </div>

            </div>

            <div class="row">

                <div class="form-group col-12">

                    <label for="profile">Image mise en avant</label>

                    <input type="file" id="profile" class="d-none" name="image">

                    <div class="preview-image m-0 d-flex justify-content-center align-items-center" style="width: 177px; height: 175px; overflow: hidden; border-radius: 8%">

                        <img src="{{ asset('assets/image/default.jpg') }}" alt="photo article" class="w-100" id="img_preview" onclick="chooseProfile(event)" style="cursor: pointer; border-radius: 8%">

                    </div>

                </div>

            </div>
            {% if communaute is defined and communaute is not null %}
            <div class="row">
                <div class="form-group col-12 ml-4">
                     <input type="hidden" value="{{ communaute }}" name="communaute">
                     <input type="checkbox" class="form-check-input" name="devenir" id="exampleCheck2" checked>
                     <label class="form-check-label ml-2" for="exampleCheck1">Devenir membre de la communauté</label>
                </div>
            </div>
             {% endif %}
            <div class="row">
                <div class="form-group col-12 ml-4">
                     <p class="ml-2" style="font-size: 14px;margin-bottom: 0px;font-weight: bold;"><span class="glyphicon glyphicon-hand-right"></span>Nous vous invitons à  lire les conditions générales d'utilisation avant de vous inscrire.</p>

                     <input type="checkbox" class="form-check-input" name="cgu" id="exampleCheck1" required>

                     <label class="form-check-label ml-2" for="exampleCheck1">J'ai lu et j'accepte les <a href="#" data-toggle="modal" data-target="#exampleModalLong"><span style="text-decoration: underline;color: rgba(13, 105, 180, 1)!important;font-weight: 100 !important;">conditions générales d'utilisation </span></a></label>

                </div>

            </div>

            <div class="form-group register-submit">

                <input class="btn btn-yellow mt-1 " disabled type="submit" value="S'inscrire">

                <a class="btn btn-yellow mt-1" href="{{ path('home') }}">Revenir</a>

            </div>

            <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">

              <div class="modal-dialog" role="document" style="max-width: 700px;">

                <div class="modal-content">

                  <div class="modal-body">

                     {% include 'user/cgu.html.twig' %}

                  </div>

                  <div class="modal-footer">

                    <button type="button" class="btn btn-yellow" data-dismiss="modal">Fermer</button>

                  </div>

                </div>

              </div>

            </div>

            

        {{ form_end(form) }}

    </div>

{% endblock %}

{% block javascripts %}

    <script type="text/javascript">
       $('#exampleCheck1').change(function(){

            if($(this).prop("checked") == true){
                $('input[type="submit"]').prop("disabled", false);
            }else{
                $('input[type="submit"]').prop("disabled", true);
            }
        });

        function chooseProfile() {

            $('#profile').click()

        }

        (function () {

            const canvas = $('canvas')[0];

            const ctx = canvas.getContext('2d');

            let img;

            const container = document.querySelector('.preview-image')

            const origin = document.querySelector('#img_preview')



            $('#profile').change(function() {

                handleFiles(this.files);

            });



            function handleFiles(files) {

                if (files.length > 0) {

                    var file = files[0];

                    if (

                        typeof FileReader !== 'undefined' &&

                        file.type.indexOf('image') != -1

                    ) {

                        var reader = new FileReader();

                        // Note: addEventListener doesn't work in Google Chrome for this event

                        reader.onload = function(evt) {

                            load(evt.target.result);

                        };

                        reader.readAsDataURL(file);

                    }

                } else {

                    load("{{ asset('assets/image/default.jpg') }}")

                }

            }



            function load(src) {

                if (src.match(/assets\/image\/default\.jpg/i)) {

                    origin.setAttribute('src', src)

                    return false

                }

                $(origin).addClass('d-none')

                $(container).find('div.water').removeClass('d-none')

                img = new Image();

                img.onload = function() {

                    run();

                };

                img.src = src;

            }



            function run() {

                if (!img) return;

                var options = {

                    width: container.offsetWidth,

                    height: container.offsetHeight,

                    minScale: 1,

                    ruleOfThirds: true,

                    debug: true

                };

                var analyzeOptions = analyze.bind(this, options);

                analyzeOptions();

            }

            function analyze(options) {

                smartcrop.crop(img, options, draw);

            }



            function draw(result) {

                var selectedCrop = result.topCrop;

                drawCrop(selectedCrop);

            }



            function drawCrop(crop) {

                canvas.width = container.offsetWidth;

                canvas.height = container.offsetHeight;

                ctx.drawImage(

                    img,

                    crop.x,

                    crop.y,

                    crop.width,

                    crop.height,

                    0,

                    0,

                    canvas.width,

                    canvas.height

                );

                $(origin).attr('src', canvas.toDataURL(img.type))

                $(origin).removeClass('d-none')

                $(container).find('div.water').addClass('d-none')

            }

        })()

    </script>

{% endblock %}

